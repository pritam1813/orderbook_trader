<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Bot Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <header class="header">
            <h1>ü§ñ Trading Bot Dashboard</h1>
            <div class="status-indicator" id="status-indicator">
                <span class="status-dot"></span>
                <span class="status-text">Connecting...</span>
            </div>
        </header>

        <main class="main">
            <!-- Status Panel -->
            <section class="panel status-panel">
                <h2>üìä Bot Status</h2>
                <div class="status-grid">
                    <div class="stat-card">
                        <span class="stat-label">Status</span>
                        <span class="stat-value" id="bot-status">--</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Direction</span>
                        <span class="stat-value" id="bot-direction">--</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Strategy</span>
                        <span class="stat-value" id="bot-strategy">--</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Uptime</span>
                        <span class="stat-value" id="bot-uptime">--</span>
                    </div>
                </div>
                <!-- Price Range Info (Micro-Grid) -->
                <div class="price-range-info" id="price-range-section">
                    <h3>üìç Price Range</h3>
                    <div class="price-range-grid">
                        <div class="range-item">
                            <span class="range-label">Initial Price</span>
                            <span class="range-value" id="initial-price">--</span>
                        </div>
                        <div class="range-item">
                            <span class="range-label">Range</span>
                            <span class="range-value" id="price-range-bounds">--</span>
                        </div>
                    </div>
                </div>
                <div class="current-trade" id="current-trade">
                    <h3>Current Trade</h3>
                    <div id="trade-details">No active trade</div>
                </div>
                <div class="bot-controls">
                    <button id="start-bot" class="btn btn-success" disabled>‚ñ∂ Start Bot</button>
                    <button id="stop-bot" class="btn btn-danger">‚èπ Stop Bot</button>
                    <span id="stop-message" class="config-message"></span>
                </div>
            </section>

            <!-- Volume Lookup Panel -->
            <section class="panel volume-lookup-panel">
                <h2>üìä My Trading Volume</h2>
                <div class="volume-lookup-form">
                    <div class="lookup-input-group">
                        <input type="text" id="volume-symbol" placeholder="Enter symbol (e.g., BTCUSDT)"
                            autocomplete="off">
                        <button class="btn btn-primary" id="volume-search">Search</button>
                    </div>
                    <div id="volume-result" class="volume-result hidden">
                        <div class="volume-stats-grid">
                            <div class="stat-card">
                                <span class="stat-label">Total Trades</span>
                                <span class="stat-value" id="ticker-trades">--</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Volume (USDT)</span>
                                <span class="stat-value" id="ticker-volume">--</span>
                            </div>
                            <div class="stat-card highlight">
                                <span class="stat-label">Net P&L</span>
                                <span class="stat-value" id="ticker-pnl">--</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Fees Paid</span>
                                <span class="stat-value fee" id="ticker-fees">--</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Buy Volume</span>
                                <span class="stat-value" id="ticker-buy">--</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Sell Volume</span>
                                <span class="stat-value" id="ticker-sell">--</span>
                            </div>
                        </div>
                    </div>
                    <div id="volume-error" class="config-message error hidden"></div>
                </div>
            </section>

            <!-- Statistics Panel -->
            <section class="panel stats-panel">
                <h2>üìà Statistics</h2>
                <div class="stats-grid">
                    <div class="stat-card highlight">
                        <span class="stat-label">Win Rate</span>
                        <span class="stat-value" id="win-rate">0%</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Wins</span>
                        <span class="stat-value win" id="total-wins">0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Losses</span>
                        <span class="stat-value loss" id="total-losses">0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Total Trades</span>
                        <span class="stat-value" id="total-trades">0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Volume</span>
                        <span class="stat-value" id="total-volume">$0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Gross P&L</span>
                        <span class="stat-value" id="total-pnl">$0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Fees</span>
                        <span class="stat-value fee" id="total-fees">$0</span>
                    </div>
                    <div class="stat-card highlight">
                        <span class="stat-label">Net P&L</span>
                        <span class="stat-value" id="net-pnl">$0</span>
                    </div>
                </div>
                <!-- Micro-Grid Specific Stats -->
                <div class="stats-grid microgrid-stats" style="margin-top: 16px;">
                    <div class="stat-card">
                        <span class="stat-label">Force Closes</span>
                        <span class="stat-value" id="force-close-count">0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Force Close P&L</span>
                        <span class="stat-value" id="force-close-pnl">$0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Maker Fees</span>
                        <span class="stat-value fee" id="maker-fees">$0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Taker Fees</span>
                        <span class="stat-value fee" id="taker-fees">$0</span>
                    </div>
                </div>
            </section>

            <!-- Trade History -->
            <section class="panel trades-panel">
                <h2>üìú Trade History</h2>
                <div class="table-container">
                    <table class="trades-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Direction</th>
                                <th>Entry</th>
                                <th>Exit</th>
                                <th>Qty</th>
                                <th>Result</th>
                                <th>P&L</th>
                                <th>Fees</th>
                                <th>Net</th>
                            </tr>
                        </thead>
                        <tbody id="trades-body">
                            <tr>
                                <td colspan="9" class="empty">No trades yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Config Panel -->
            <section class="panel config-panel">
                <h2>‚öôÔ∏è Configuration</h2>
                <form id="config-form" class="config-form">
                    <div class="config-group">
                        <h3>Trading</h3>
                        <div class="config-row">
                            <label>Symbol</label>
                            <input type="text" name="symbol" id="cfg-symbol">
                        </div>
                        <div class="config-row">
                            <label>Quantity</label>
                            <input type="number" step="0.001" name="quantity" id="cfg-quantity">
                        </div>
                        <div class="config-row">
                            <label>Leverage</label>
                            <input type="number" min="1" max="125" name="leverage" id="cfg-leverage">
                        </div>
                    </div>

                    <div class="config-group">
                        <h3>Strategy</h3>
                        <div class="config-row">
                            <label>Strategy</label>
                            <select name="strategy" id="cfg-strategy">
                                <option value="orderbook">Orderbook</option>
                                <option value="risk_reward">Risk-Reward</option>
                                <option value="micro_grid">Micro-Grid</option>
                            </select>
                        </div>
                        <div class="config-row">
                            <label>Initial Direction</label>
                            <select name="initialDirection" id="cfg-direction">
                                <option value="LONG">LONG</option>
                                <option value="SHORT">SHORT</option>
                            </select>
                        </div>
                        <div class="config-row">
                            <label>Direction Switch Losses</label>
                            <input type="number" min="1" name="directionSwitchLosses" id="cfg-switch-losses">
                        </div>
                    </div>

                    <div class="config-group orderbook-config">
                        <h3>Orderbook Strategy</h3>
                        <div class="config-row">
                            <label>Entry Level</label>
                            <input type="number" min="1" max="20" name="entryLevel" id="cfg-entry-level">
                        </div>
                        <div class="config-row">
                            <label>TP Level</label>
                            <input type="number" min="1" max="20" name="tpLevel" id="cfg-tp-level">
                        </div>
                        <div class="config-row">
                            <label>SL Level</label>
                            <input type="number" min="1" max="20" name="slLevel" id="cfg-sl-level">
                        </div>
                    </div>

                    <div class="config-group rr-config">
                        <h3>Risk-Reward Strategy</h3>
                        <div class="config-row">
                            <label>Risk:Reward Ratio</label>
                            <input type="number" step="0.1" min="0.1" name="riskRewardRatio" id="cfg-rr-ratio">
                        </div>
                        <div class="config-row">
                            <label>SL Distance %</label>
                            <input type="number" step="0.01" min="0.01" name="slDistancePercent" id="cfg-sl-percent">
                        </div>
                    </div>

                    <div class="config-group microgrid-config">
                        <h3>Micro-Grid Strategy</h3>
                        <div class="config-row">
                            <label>Base Spread %</label>
                            <input type="number" step="0.01" min="0.01" name="spreadGapPercent" id="cfg-spread-gap">
                        </div>
                        <div class="config-row">
                            <label>Min Spread %</label>
                            <input type="number" step="0.01" min="0.01" name="minSpreadPercent" id="cfg-min-spread">
                        </div>
                        <div class="config-row">
                            <label>Max Spread %</label>
                            <input type="number" step="0.01" min="0.01" name="maxSpreadPercent" id="cfg-max-spread">
                        </div>
                        <div class="config-row">
                            <label>Price Range %</label>
                            <input type="number" step="0.5" min="0.5" max="10" name="priceRangePercent"
                                id="cfg-price-range">
                        </div>
                        <div class="config-row">
                            <label>Volatility Lookback (min)</label>
                            <input type="number" step="1" min="1" max="60" name="volatilityLookbackMinutes"
                                id="cfg-volatility-lookback">
                        </div>
                        <div class="config-row">
                            <label>Rolling Price Update Trades</label>
                            <input type="number" step="1" min="1" max="100" name="rollingPriceUpdateTrades"
                                id="cfg-rolling-update">
                        </div>
                    </div>

                    <div class="config-group microgrid-config">
                        <h3>Micro-Grid Risk Management</h3>
                        <div class="config-row">
                            <label>Max Position Multiplier</label>
                            <input type="number" step="1" min="1" max="50" name="maxPositionMultiplier"
                                id="cfg-max-pos-mult">
                        </div>
                        <div class="config-row">
                            <label>Daily Loss Limit %</label>
                            <input type="number" step="0.5" min="1" max="20" name="dailyLossLimitPercent"
                                id="cfg-daily-loss">
                        </div>
                        <div class="config-row">
                            <label>Maker Fee %</label>
                            <input type="number" step="0.001" min="0" max="0.1" name="makerFeePercent"
                                id="cfg-maker-fee">
                        </div>
                        <div class="config-row">
                            <label>Taker Fee %</label>
                            <input type="number" step="0.001" min="0" max="0.1" name="takerFeePercent"
                                id="cfg-taker-fee">
                        </div>
                    </div>

                    <div class="config-group microgrid-config">
                        <h3>Position Reduction</h3>
                        <div class="config-row">
                            <label>Emergency Close Deviation %</label>
                            <input type="number" step="0.1" min="0.5" max="5" name="emergencyCloseDeviationPercent"
                                id="cfg-emergency-deviation">
                        </div>
                        <div class="config-row">
                            <label>Stabilization Wait (min)</label>
                            <input type="number" step="1" min="1" max="30" name="stabilizationWaitMinutes"
                                id="cfg-stabilization-wait">
                        </div>
                        <div class="config-row">
                            <label>Reduce Order Timeout (s)</label>
                            <input type="number" step="5" min="5" max="120" name="reduceOrderTimeoutSeconds"
                                id="cfg-reduce-timeout">
                        </div>
                        <div class="config-row">
                            <label>Position Resume Threshold %</label>
                            <input type="number" step="5" min="10" max="100" name="positionResumeThresholdPercent"
                                id="cfg-resume-threshold">
                        </div>
                        <div class="config-row">
                            <label>Pause Auto-Reset (min)</label>
                            <input type="number" step="1" min="1" max="60" name="pauseAutoResetMinutes"
                                id="cfg-pause-reset">
                        </div>
                        <div class="config-row">
                            <label>Resume Buffer %</label>
                            <input type="number" step="0.1" min="0" max="5" name="priceRangeResumeBufferPercent"
                                id="cfg-resume-buffer"
                                title="Price must come back this % inside range before resuming (prevents oscillation)">
                        </div>
                    </div>

                    <div class="config-group">
                        <h3>Timing</h3>
                        <div class="config-row">
                            <label>Order Timeout (s)</label>
                            <input type="number" min="5" max="300" name="orderTimeoutSeconds" id="cfg-timeout">
                        </div>
                        <div class="config-row">
                            <label>TP/SL Monitor Interval (s)</label>
                            <input type="number" min="1" max="60" name="tpslMonitorIntervalSeconds"
                                id="cfg-monitor-interval">
                        </div>
                    </div>

                    <div class="config-actions">
                        <button type="submit" class="btn btn-primary">Save Config</button>
                        <span id="config-message" class="config-message"></span>
                    </div>
                </form>
            </section>

            <!-- Live Logs -->
            <section class="panel logs-panel">
                <h2>üìã Live Logs</h2>
                <div class="logs-controls">
                    <button id="clear-logs" class="btn btn-secondary">Clear</button>
                    <label><input type="checkbox" id="auto-scroll" checked> Auto-scroll</label>
                </div>
                <div class="logs-container" id="logs-container"></div>
            </section>

            <!-- Log Files Download -->
            <section class="panel logfiles-panel">
                <h2>üìÅ Log Files</h2>
                <div class="logs-controls">
                    <button id="refresh-logs" class="btn btn-secondary">üîÑ Refresh</button>
                    <span id="current-log" class="current-log-indicator"></span>
                </div>
                <div class="table-container">
                    <table class="trades-table logs-table">
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Size</th>
                                <th>Created</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="logfiles-body">
                            <tr>
                                <td colspan="4" class="empty">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <script src="app.js"></script>
</body>

</html>